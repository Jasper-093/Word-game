<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>è¶£å‘³å–®å­—é»˜å¯«ï¼ˆå°å­¸ç‰ˆï¼‰</title>
<style>
  /* --------- åŸºæœ¬æ¨£å¼ï¼ˆå…’ç«¥å‹å¥½ï¼‰ --------- */
  :root{
    --bg: #f0f8ff;
    --card: #ffffff;
    --accent: #4dabf7;
    --muted: #6c757d;
    --good: #2b8a3e;
    --bad: #c92a2a;
  }
  *{box-sizing: border-box}
  body{
    margin:0;
    font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    background: linear-gradient(135deg,#e6f2ff 0%, #f8fbff 100%);
    color:#123;
    padding:18px;
    -webkit-font-smoothing:antialiased;
  }
  .wrap{
    max-width: 1000px;
    margin: 8px auto;
    background: var(--card);
    border-radius: 20px;
    box-shadow: 0 12px 30px rgba(15,40,80,0.08);
    padding: 22px;
    overflow: hidden;
  }

  header{
    text-align:center;
    padding-bottom: 12px;
    border-bottom: 3px dashed #d6eaff;
  }
  h1{
    margin: 8px 0;
    font-size: 2rem;
    color:#0b66b2;
  }
  p.lead{
    margin:0;
    color:var(--muted);
    font-size: 1rem;
  }

  .game {
    display:flex;
    gap:18px;
    margin-top:18px;
    flex-wrap:wrap;
  }

  /* å·¦å´ä¸»å€ï¼šé¡Œç›®ã€è¼¸å…¥ã€å­—æ¯é¢æ¿ */
  .left{
    flex:1 1 520px;
    min-width:320px;
  }
  .card{
    background: #fbfeff;
    border-radius: 14px;
    padding: 16px;
    box-shadow: 0 6px 18px rgba(10,30,80,0.04);
    border: 3px solid rgba(150,200,255,0.25);
    margin-bottom: 14px;
  }

  .chinese {
    font-size: 3rem;
    color: #1b6fb3;
    font-weight:700;
    text-align:center;
    padding: 10px 6px;
  }

  .controls{
    display:flex;
    gap:10px;
    margin-top:8px;
    justify-content: center;
    flex-wrap:wrap;
  }
  button.btn{
    border:none;
    padding:12px 16px;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
    font-size:1rem;
    box-shadow: 0 6px 12px rgba(10,30,80,0.06);
  }
  .btn-start{ background:#40c057; color:white; }
  .btn-submit{ background: #339af0; color:white; }
  .btn-restart{ background: #ff922b; color:white; }
  .btn-disabled{ opacity:0.5; pointer-events:none; }

  .timer{
    text-align:center;
    margin-top:8px;
  }
  .timer .time{
    font-size:2.6rem;
    font-weight:900;
    color:#ff7b00;
    letter-spacing:2px;
  }
  .timer .label{ color:var(--muted); font-weight:700; }

  .answer-input{
    display:flex;
    gap:8px;
    justify-content:center;
    align-items:center;
    margin-top:12px;
  }
  input[type="text"].answer {
    width:80%;
    max-width:480px;
    padding:14px 12px;
    font-size:1.6rem;
    text-align:center;
    border-radius:12px;
    border:3px solid #a6d1ff;
    background:#f0fbff;
    font-weight:700;
    letter-spacing: 2px;
    color:#0b6fb2;
  }
  input.answer:focus{ outline: none; box-shadow:0 0 0 6px rgba(28,126,214,0.08); }

  .letters {
    margin-top:16px;
    display:grid;
    grid-template-columns: repeat(9, 1fr);
    gap:8px;
    justify-items:stretch;
  }
  @media (max-width:900px){ .letters{ grid-template-columns: repeat(7, 1fr); } }
  @media (max-width:520px){ .letters{ grid-template-columns: repeat(6, 1fr); } }

  .letter {
    user-select:none;
    border-radius:10px;
    padding:10px 6px;
    font-weight:900;
    font-size:1.2rem;
    text-align:center;
    cursor:pointer;
    color:white;
    box-shadow: 0 6px 10px rgba(10,30,80,0.06);
    transition: transform .08s;
  }
  .letter:active{ transform: translateY(2px) scale(.99); }
  .letter.disabled { opacity:0.4; pointer-events:none; transform:none; }

  /* å³å´ï¼šé€²åº¦/åˆ†æ•¸/åˆ—è¡¨ */
  .right{
    width:320px;
    min-width:260px;
  }
  .stat-row{
    display:flex;
    gap:8px;
    justify-content:space-between;
    margin-bottom:10px;
  }
  .stat{
    flex:1;
    background:#fff;
    padding:12px;
    border-radius:10px;
    text-align:center;
    border:3px solid rgba(99,230,190,0.18);
  }
  .stat h4{ margin:0; font-size:1.6rem; color:#2b8aef; }
  .stat p{ margin:4px 0 0; color:var(--muted); font-weight:700; }

  .progress-bar{
    height:18px;
    background:#eef6f2;
    border-radius:12px;
    overflow:hidden;
    margin-top:10px;
    border:3px solid rgba(156,219,203,0.18);
  }
  .progress-fill{
    height:100%;
    width:0%;
    background: linear-gradient(90deg,#20c997,#63e6be);
    transition: width .5s ease;
  }

  .feedback{
    margin-top:12px;
    padding:12px;
    border-radius:10px;
    text-align:center;
    font-weight:900;
    font-size:1.1rem;
    min-height:56px;
  }
  .feedback.ok{ background:#d3f9d8; color: #2b8a3e; border:3px solid #69db7c; }
  .feedback.bad{ background:#ffe3e3; color:#c92a2a; border:3px solid #ff8787; }
  .word-list{
    margin-top:14px;
    padding-top:8px;
    border-top:2px dashed #e6eefc;
  }
  .word-list h3{ text-align:center; color:#416; }
  .word-pair{
    display:flex;
    justify-content:space-between;
    gap:10px;
    padding:6px 8px;
    border-radius:8px;
    background:#fbfdff;
    margin-bottom:6px;
    border:1px solid #f0f6ff;
  }

  /* å°æç¤º */
  .hint{
    margin-top:8px;
    text-align:center;
    color:#555;
    font-weight:700;
  }

  footer{
    margin-top:16px;
    text-align:center;
    color:var(--muted);
    font-size:.95rem;
  }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="å–®å­—é»˜å¯«éŠæˆ²">
    <header>
      <h1>è¶£å‘³å–®å­—é»˜å¯«ï¼ˆå°å­¸ç‰ˆï¼‰</h1>
      <p class="lead">é¡¯ç¤ºä¸­æ–‡ï¼Œè«‹è¼¸å…¥å®Œæ•´è‹±æ–‡å–®å­—ã€‚å¯é»å­—æ¯æ–¹å¡Šæˆ–ç›´æ¥éµç›¤è¼¸å…¥ã€‚ç¥ä½ ç©å¾—é–‹å¿ƒï¼</p>
    </header>

    <main class="game" id="app">
      <section class="left">
        <div class="card" aria-live="polite">
          <div class="chinese" id="chineseWord">æŒ‰ã€Œé–‹å§‹ã€é¡¯ç¤ºä¸­æ–‡</div>

          <div class="controls" id="topControls">
            <button class="btn btn-start" id="startBtn" aria-pressed="false">é–‹å§‹</button>
            <button class="btn btn-submit btn-disabled" id="submitBtn">æäº¤</button>
            <button class="btn btn-restart" id="restartBtn">é‡æ–°é–‹å§‹</button>
          </div>

          <div class="timer" role="timer" aria-atomic="true">
            <div class="time" id="timeDisplay">00</div>
            <div class="label">å€’æ•¸ç§’æ•¸</div>
          </div>

          <div class="answer-input">
            <input type="text" class="answer" id="answerInput" autocomplete="off" inputmode="latin" aria-label="è¼¸å…¥å–®å­—" placeholder="è¼¸å…¥æˆ–é»é¸å­—æ¯..." />
          </div>

          <div class="hint" id="hintText">æç¤ºï¼šå¯ç”¨æ»‘é¼ é»å­—æ¯æˆ–ç›´æ¥éµç›¤è¼¸å…¥ã€‚æŒ‰ Enter å¯æäº¤ã€‚</div>

          <!-- å­—æ¯æŒ‰éˆ• -->
          <div class="letters card" id="lettersPanel" aria-label="å­—æ¯é¢æ¿">
            <!-- JS æœƒå‹•æ…‹ç”Ÿæˆ A-Z æŒ‰éˆ• -->
          </div>

          <div style="margin-top:12px; text-align:center; color:#666; font-weight:700;">
            å·²è¼¸å…¥ï¼š<span id="typedDisplay">ï¼ˆç„¡ï¼‰</span>
          </div>
        </div>

        <!-- é¡¯ç¤ºç­”æ¡ˆèˆ‡æç¤º -->
        <div class="card" id="bottomCard" aria-live="polite">
          <div class="feedback" id="feedbackArea">æº–å‚™å¥½äº†å—ï¼ŸæŒ‰é–‹å§‹ï¼</div>
        </div>
      </section>

      <aside class="right">
        <div class="card">
          <div class="stat-row">
            <div class="stat">
              <h4 id="scoreVal">0</h4>
              <p>å¾—åˆ†</p>
            </div>
            <div class="stat">
              <h4 id="attemptVal">0</h4>
              <p>ç­”é¡Œæ•¸</p>
            </div>
          </div>

          <div class="progress-label" style="font-weight:900; color:#0b6fb2; margin-top:4px;">
            é€²åº¦
          </div>
          <div class="progress-bar" aria-hidden="false">
            <div class="progress-fill" id="progressFill"></div>
          </div>

          <div style="margin-top:10px;">
            <button class="btn btn-start" id="showAnswerBtn" style="width:100%;">é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆï¼ˆæç¤ºï¼‰</button>
          </div>
        </div>

        <div class="card word-list">
          <h3>å–®å­—åˆ—è¡¨ï¼ˆä¸­ â€” è‹±ï¼‰</h3>
          <div id="wordList">
            <!-- JS å¡«å……åå–® -->
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <small>è¨­è¨ˆçµ¦å°å­¸ç”Ÿï¼šå¤§æŒ‰éˆ•ã€ç°¡å–®æ–‡å­—ã€è‰²å½©å‹å–„ã€‚ç¥å­¸ç¿’æ„‰å¿«ï¼</small>
    </footer>
  </div>

<script>
/*
  å®Œæ•´å–®æ–‡ä»¶ JSï¼š
  - æ”¯æ´é»å­—æ¯æˆ–éµç›¤è¼¸å…¥
  - å€’è¨ˆæ™‚ï¼ˆæ¯é¡Œå¯è¨­å®šç§’æ•¸ï¼‰
  - éš¨æ©Ÿé¡Œç›®ï¼ˆå¯èª¿æ•´é¡Œç›®æ¬¡æ•¸ï¼‰
  - æª¢æŸ¥ç­”æ¡ˆï¼ˆå¤§å°å¯«ä¸æ•æ„Ÿï¼‰
  - é¡¯ç¤ºé€²åº¦ã€å¾—åˆ†ã€ç­”é¡Œæ•¸
*/

(function(){
  // --- å¯èª¿åƒæ•¸ ---
  const QUESTION_COUNT = 20;       // ä¸€å›åˆçš„é¡Œç›®æ•¸ï¼ˆé€²åº¦æ¢æ»¿ï¼‰
  const DEFAULT_SECONDS = 18;      // æ¯é¡Œå€’æ•¸ç§’æ•¸
  const WORDS = [
    // å¸¸ç”¨å°å­¸è©å½™ï¼šä¸­æ–‡ â€” è‹±æ–‡
    {c:'è˜‹æœ', e:'apple'},
    {c:'æ©˜å­', e:'orange'},
    {c:'é¦™è•‰', e:'banana'},
    {c:'è‘¡è„', e:'grape'},
    {c:'è¥¿ç“œ', e:'watermelon'},
    {c:'ç‹—', e:'dog'},
    {c:'è²“', e:'cat'},
    {c:'é­š', e:'fish'},
    {c:'é³¥', e:'bird'},
    {c:'è€å¸«', e:'teacher'},
    {c:'å­¸ç”Ÿ', e:'student'},
    {c:'æ›¸', e:'book'},
    {c:'é‰›ç­†', e:'pencil'},
    {c:'æ©¡çš®', e:'eraser'},
    {c:'å­¸æ ¡', e:'school'},
    {c:'å®¶', e:'home'},
    {c:'é–€', e:'door'},
    {c:'çª—æˆ¶', e:'window'},
    {c:'æ¡Œå­', e:'table'},
    {c:'æ¤…å­', e:'chair'},
    {c:'çƒ', e:'ball'},
    {c:'é›¨', e:'rain'},
    {c:'å¤ªé™½', e:'sun'},
    {c:'æœˆäº®', e:'moon'},
    {c:'æ˜Ÿæ˜Ÿ', e:'star'},
    {c:'è»Š', e:'car'},
    {c:'èˆ¹', e:'boat'},
    {c:'é£›æ©Ÿ', e:'plane'},
    {c:'è˜‘è‡', e:'mushroom'},
    {c:'ç´…è‰²', e:'red'},
    {c:'è—è‰²', e:'blue'},
    {c:'é»ƒè‰²', e:'yellow'},
    {c:'ç¶ è‰²', e:'green'},
    {c:'é»‘è‰²', e:'black'},
    {c:'ç™½è‰²', e:'white'},
    {c:'åª½åª½', e:'mother'},
    {c:'çˆ¸çˆ¸', e:'father'},
    {c:'å§å§', e:'sister'},
    {c:'å“¥å“¥', e:'brother'},
    {c:'æ™‚é–“', e:'time'},
    {c:'æ°´', e:'water'},
    {c:'ç‰›å¥¶', e:'milk'},
    {c:'è›‹', e:'egg'},
    {c:'éºµåŒ…', e:'bread'},
    {c:'ç³–', e:'sugar'},
    {c:'è˜‹æœæ´¾', e:'pie'},
    {c:'é†«ç”Ÿ', e:'doctor'},
    {c:'åœ–æ›¸é¤¨', e:'library'},
    {c:'å‹•ç‰©', e:'animal'},
    {c:'åŸå¸‚', e:'city'},
    {c:'é„‰æ‘', e:'village'},
    {c:'ç­ç´š', e:'class'},
    {c:'æœ‹å‹', e:'friend'}
  ];

  // --- DOM åƒè€ƒ ---
  const startBtn = document.getElementById('startBtn');
  const submitBtn = document.getElementById('submitBtn');
  const restartBtn = document.getElementById('restartBtn');
  const timeDisplay = document.getElementById('timeDisplay');
  const chineseWord = document.getElementById('chineseWord');
  const answerInput = document.getElementById('answerInput');
  const lettersPanel = document.getElementById('lettersPanel');
  const feedbackArea = document.getElementById('feedbackArea');
  const scoreVal = document.getElementById('scoreVal');
  const attemptVal = document.getElementById('attemptVal');
  const progressFill = document.getElementById('progressFill');
  const typedDisplay = document.getElementById('typedDisplay');
  const showAnswerBtn = document.getElementById('showAnswerBtn');
  const wordListContainer = document.getElementById('wordList');

  // --- å…§éƒ¨ç‹€æ…‹ ---
  let currentWord = null;
  let remainingSeconds = DEFAULT_SECONDS;
  let timerId = null;
  let isRunning = false;
  let score = 0;
  let attempts = 0;
  let askedCount = 0;
  let order = []; // éš¨æ©Ÿé¡Œåºï¼ˆindexï¼‰
  let allowSubmit = false;

  // --- åˆå§‹åŒ– UI / ç”¢ç”Ÿå­—æ¯æŒ‰éˆ• / åˆ—è¡¨ ---
  const palette = [
    '#ff6b6b','#ffd43b','#51cf66','#339af0','#845ef7','#ff922b','#16a34a','#ef476f','#06b6d4',
    '#f783ac','#7c3aed','#06d6a0','#f59e0b','#ff85a1'
  ];
  function randColor(i){
    return palette[i % palette.length];
  }

  function createLetterButtons(){
    lettersPanel.innerHTML = '';
    const Acode = 'A'.charCodeAt(0);
    for(let i=0;i<26;i++){
      const ch = String.fromCharCode(Acode + i);
      const div = document.createElement('div');
      div.className = 'letter';
      div.textContent = ch;
      div.setAttribute('data-letter', ch);
      const color = randColor(i);
      div.style.background = color;
      div.style.border = '3px solid rgba(255,255,255,0.08)';
      div.style.boxShadow = 'inset 0 -6px 12px rgba(0,0,0,0.06), 0 6px 12px rgba(10,30,80,0.06)';
      div.addEventListener('click', onLetterClick);
      lettersPanel.appendChild(div);
    }
  }

  function populateWordList(){
    wordListContainer.innerHTML = '';
    WORDS.forEach(w=>{
      const row = document.createElement('div');
      row.className = 'word-pair';
      row.innerHTML = '<div style="font-weight:800;color:#1b6fb3">'+ w.c +'</div><div style="font-weight:900;color:#2b8aef">'+ w.e +'</div>';
      wordListContainer.appendChild(row);
    });
  }

  // --- é¸é¡Œï¼ˆéš¨æ©Ÿç„¡é‡è¤‡ï¼‰---
  function prepareOrder(){
    const indices = WORDS.map((_,i)=>i);
    // Fisher-Yates shuffle
    for(let i=indices.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [indices[i], indices[j]] = [indices[j], indices[i]];
    }
    // å–å‰ QUESTION_COUNTï¼ˆæˆ–å…¨éƒ¨ï¼‰
    order = indices.slice(0, Math.min(QUESTION_COUNT, indices.length));
    askedCount = 0;
  }

  // --- é¡¯ç¤ºï¼ˆæ–°é¡Œï¼‰ ---
  function nextQuestion(){
    if(askedCount >= order.length){
      // å›åˆçµæŸ
      endRound();
      return;
    }
    const idx = order[askedCount];
    currentWord = WORDS[idx];
    chineseWord.textContent = currentWord.c;
    answerInput.value = '';
    typedDisplay.textContent = 'ï¼ˆç„¡ï¼‰';
    feedbackArea.textContent = 'è«‹è¼¸å…¥å®Œæ•´çš„è‹±æ–‡å–®å­—ï¼ŒæŒ‰æäº¤æˆ– Enterã€‚';
    feedbackArea.className = 'feedback';
    remainingSeconds = DEFAULT_SECONDS;
    updateTimerDisplay();
    enableSubmit(false);
    clearLetterSelection();
    answerInput.focus();
    askedCount++;
    updateProgress();
  }

  function updateProgress(){
    const pct = Math.round(( (askedCount-1) / order.length ) * 100);
    progressFill.style.width = pct + '%';
  }

  function endRound(){
    isRunning = false;
    clearInterval(timerId);
    timerId = null;
    feedbackArea.textContent = `æœ¬å›åˆçµæŸï¼å…±ç­”é¡Œ ${attempts} é¡Œï¼Œå¾—åˆ† ${score}ã€‚`;
    feedbackArea.className = 'feedback';
    chineseWord.textContent = 'å›åˆå·²çµæŸï¼ŒæŒ‰ã€Œé‡æ–°é–‹å§‹ã€æˆ–ã€Œé–‹å§‹ã€å†è©¦ä¸€æ¬¡';
    enableSubmit(false);
    startBtn.classList.remove('btn-disabled');
    answerInput.blur();
    progressFill.style.width = '100%';
  }

  function startRound(){
    score = 0;
    attempts = 0;
    scoreVal.textContent = '0';
    attemptVal.textContent = '0';
    prepareOrder();
    createLetterButtons();
    clearInterval(timerId);
    timerId = null;
    isRunning = true;
    startBtn.classList.add('btn-disabled');
    enableSubmit(false);
    nextQuestion();
    startTimer();
  }

  function restartRound(){
    // ä¿ç•™é¡Œåº«ä½†é‡æ–°é–‹å§‹æ–°å›åˆ
    startBtn.classList.remove('btn-disabled');
    prepareOrder();
    score = 0;
    attempts = 0;
    askedCount = 0;
    scoreVal.textContent = '0';
    attemptVal.textContent = '0';
    progressFill.style.width = '0%';
    feedbackArea.textContent = 'å·²é‡ç½®ï¼ŒæŒ‰é–‹å§‹ã€‚';
    feedbackArea.className = 'feedback';
    chineseWord.textContent = 'æŒ‰ã€Œé–‹å§‹ã€é¡¯ç¤ºé¡Œç›®';
    clearInterval(timerId);
    timerId = null;
    isRunning = false;
    enableSubmit(false);
    clearLetterSelection();
  }

  // --- è¨ˆæ™‚å™¨ ---
  function startTimer(){
    if(timerId) clearInterval(timerId);
    timerId = setInterval(()=>{
      remainingSeconds--;
      updateTimerDisplay();
      if(remainingSeconds <= 0){
        // æ™‚é–“åˆ°ï¼Œè¦–ç‚ºéŒ¯èª¤ä¸¦é€²å…¥ä¸‹ä¸€é¡Œ
        handleSubmit(true); // true è¡¨ç¤ºå› æ™‚é–“åˆ°è‡ªå‹•æäº¤ï¼ˆéŒ¯èª¤ï¼‰
      }
    }, 1000);
  }

  function updateTimerDisplay(){
    timeDisplay.textContent = String(remainingSeconds).padStart(2,'0');
  }

  // --- å­—æ¯é»æ“Šè™•ç† ---
  function onLetterClick(e){
    const letter = e.currentTarget.getAttribute('data-letter') || '';
    if(!letter) return;
    // æŠŠå­—æ¯é™„åŠ åˆ°è¼¸å…¥æ¡†
    answerInput.value = (answerInput.value + letter).slice(0, 30); // é™é•·
    typedDisplay.textContent = answerInput.value || 'ï¼ˆç„¡ï¼‰';
    // æŠŠè©²æŒ‰éˆ•æ”¹æˆ disabledï¼ˆé˜²æ­¢é‡è¤‡é»ï¼‰
    e.currentTarget.classList.add('disabled');
    enableSubmit(true);
    answerInput.focus();
  }

  function clearLetterSelection(){
    const els = lettersPanel.querySelectorAll('.letter');
    els.forEach(el=>el.classList.remove('disabled'));
  }

  // --- æäº¤/æª¢æŸ¥ç­”æ¡ˆ ---
  function enableSubmit(flag){
    allowSubmit = !!flag;
    if(allowSubmit){
      submitBtn.classList.remove('btn-disabled');
    } else {
      submitBtn.classList.add('btn-disabled');
    }
  }

  function handleSubmit(isTimeout=false){
    if(!isRunning) return;
    const typed = (answerInput.value || '').trim();
    const correct = currentWord ? currentWord.e.trim().toLowerCase() : '';
    attempts++;
    attemptVal.textContent = String(attempts);
    // åœè¨ˆæ™‚ä¸€å°æ®µæ™‚é–“é¡¯ç¤ºçµæœ
    clearInterval(timerId);
    timerId = null;
    if(!typed || isTimeout){
      // éŒ¯èª¤
      feedbackArea.textContent = `æ™‚é–“åˆ°æˆ–æœªè¼¸å…¥ï¼æ­£ç¢ºç­”æ¡ˆï¼š ${correct}`;
      feedbackArea.className = 'feedback bad';
    } else {
      if(typed.toLowerCase() === correct.toLowerCase()){
        score++;
        scoreVal.textContent = String(score);
        feedbackArea.textContent = 'ç­”å°äº†ï¼å¾ˆå¥½ ğŸ‘';
        feedbackArea.className = 'feedback ok';
      } else {
        feedbackArea.textContent = `ç­”éŒ¯äº†ï¼ä½ çš„ç­”æ¡ˆ: ${typed}ï¼›æ­£ç¢º: ${correct}`;
        feedbackArea.className = 'feedback bad';
      }
    }

    // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ 1.5 ç§’å¾Œé€²ä¸‹ä¸€é¡Œ
    setTimeout(()=>{
      // è‹¥é¡Œç›®åšå®Œå‰‡çµæŸ
      if(askedCount >= order.length){
        endRound();
        return;
      }
      // å¦å‰‡ä¸‹ä¸€é¡Œ
      nextQuestion();
      startTimer();
    }, 1200);
  }

  // --- é¡¯ç¤ºç­”æ¡ˆæç¤º ---
  function revealAnswer(){
    if(!currentWord) return;
    feedbackArea.textContent = `æç¤ºç­”æ¡ˆï¼š ${currentWord.e}`;
    feedbackArea.className = 'feedback';
  }

  // --- éµç›¤è™•ç†ï¼ˆè¼¸å…¥/Backspace/Enterï¼‰ ---
  answerInput.addEventListener('input', (e)=>{
    // è‹¥æœ‰è¼¸å…¥å‰‡å•Ÿç”¨æäº¤
    const v = e.target.value || '';
    typedDisplay.textContent = v ? v : 'ï¼ˆç„¡ï¼‰';
    // ç•¶ä½¿ç”¨éµç›¤è¼¸å…¥æ™‚ï¼Œè§£é™¤ letter æŒ‰éˆ• disabledï¼ˆé¿å…è·Ÿé»æ“Šæ··æ·†ï¼‰
    const els = lettersPanel.querySelectorAll('.letter');
    els.forEach(el=>el.classList.remove('disabled'));
    enableSubmit(!!v.trim());
  });

  answerInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      e.preventDefault();
      if(!submitBtn.classList.contains('btn-disabled')){
        handleSubmit(false);
      }
    }
    if(e.key === 'Escape'){
      answerInput.value = '';
      typedDisplay.textContent = 'ï¼ˆç„¡ï¼‰';
      enableSubmit(false);
    }
  });

  // å…¨åŸŸéµç›¤ï¼šè‹¥ä½¿ç”¨è€…ç›´æ¥æŒ‰ A~Zï¼Œä¹Ÿè¼¸å…¥åˆ°æ¬„ä½ï¼ˆä¸æœƒè§¸ç™¼å­—æ¯ disabledï¼‰
  document.addEventListener('keydown', (e)=>{
    if(!isRunning) return;
    const k = e.key;
    if(/^[a-zA-Z]$/.test(k)){
      answerInput.value = answerInput.value + k.toLowerCase();
      typedDisplay.textContent = answerInput.value;
      enableSubmit(!!answerInput.value.trim());
    }
    if(k === 'Backspace'){
      // ä¿æŒæ­£å¸¸ç€è¦½å™¨åˆªé™¤è¡Œç‚º
      // typedDisplay åœ¨ input event è£¡æœƒæ›´æ–°
    }
  });

  // --- äº‹ä»¶ç¶å®š ---
  startBtn.addEventListener('click', ()=>{
    if(startBtn.classList.contains('btn-disabled')) return;
    startRound();
  });
  restartBtn.addEventListener('click', ()=>{
    restartRound();
  });
  submitBtn.addEventListener('click', ()=>{
    if(submitBtn.classList.contains('btn-disabled')) return;
    handleSubmit(false);
  });
  showAnswerBtn.addEventListener('click', revealAnswer);

  // --- åˆå§‹åŒ– ---
  createLetterButtons();
  populateWordList();
  prepareOrder();
  updateTimerDisplay();
  enableSubmit(false);

  // é¡å¤–ï¼šåœ¨å°è¢å¹•ä¸Šè‡ªå‹•ç¸®çŸ­å­—æ¯æ’åˆ—ï¼ˆå·²ä½¿ç”¨ media queryï¼‰
})();
</script>
</body>
</html>
        <div class="slots" id="slotsArea" aria-hidden="false"></div>

        <div class="inputRow">
          <!-- hidden input to capture keyboard focus -->
          <input id="hiddenInput" class="hiddenInput" autocomplete="off" inputmode="text" />
          <div style="display:flex;gap:8px">
            <button class="btn btn-clear" id="btnClear" title="åˆªé™¤æœ€å¾Œä¸€å€‹å­—">åˆªé™¤</button>
          </div>
        </div>

        <div class="letterPanel" id="letters"></div>

        <div class="controls">
          <button class="btn btn-submit" id="btnSubmit">æäº¤ç­”æ¡ˆ</button>
          <button class="btn btn-next disabled" id="btnNext">ä¸‹ä¸€é¡Œ</button>
        </div>

        <div id="feedback" class="feedback" aria-live="assertive">æº–å‚™å¥½äº†ï¼šæŒ‰ã€Œä¸‹ä¸€é¡Œã€é–‹å§‹</div>
        <div class="hint">æç¤ºï¼šæŒ‰å­—æ¯æˆ–ç›´æ¥ç”¨éµç›¤ Aâ€“Zï¼›æŒ‰ Backspace åˆªé™¤ä¸€å€‹å­—æ¯ã€‚</div>
      </div>
    </section>

    <aside class="right">
      <div class="card">
        <div class="stat"><div>å¾—åˆ†</div><div class="num" id="score">0</div></div>
        <div class="stat"><div>å·²ç­”é¡Œ</div><div class="num" id="answered">0</div></div>
        <div style="margin-top:8px">
          <div style="font-weight:900;color:#0b66b2">é€²åº¦</div>
          <div style="height:12px;background:#eef6ff;border-radius:8px;margin-top:6px;overflow:hidden;border:3px solid rgba(99,230,203,0.12)">
            <div id="progressBar" style="height:100%;width:0%;background:linear-gradient(90deg,#20c997,#63e6be);transition:width .5s"></div>
          </div>
        </div>
      </div>

      <div class="card" style="max-height:360px;overflow:auto">
        <div style="font-weight:900;color:#0b66b2;margin-bottom:8px">é¡Œåº«ç¯„ä¾‹ï¼ˆä¸­æ–‡ â€” è‹±ï¼‰</div>
        <div id="sampleList" style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px"></div>
        <div style="font-size:.9rem;color:var(--muted);margin-top:8px">å…± 180 é¡Œï¼ˆ80% åŸºç¤ + 20% é€²éšï¼‰</div>
      </div>
    </aside>
  </main>

  <footer><small>è¨­è¨ˆçµ¦å°å­¸ç”Ÿï¼šå¤§æŒ‰éˆ•ã€ç°¡å–®æµç¨‹ã€å¡é€šåœ–ç¤ºã€‚</small></footer>
</div>

<script>
/* ======= é¡Œåº«ï¼ˆ180 é¡Œï¼‰ ======= */
/* ï¼ˆä¿æŒä½ å…ˆå‰çš„é¡Œåº« â€” å¯è‡ªè¡Œèª¿æ•´ï¼‰ */
const WORDS = [
  {c:'è˜‹æœ',e:'apple'},{c:'é¦™è•‰',e:'banana'},{c:'æ©˜å­',e:'orange'},{c:'è‘¡è„',e:'grape'},
  {c:'è¥¿ç“œ',e:'watermelon'},{c:'æ¢¨',e:'pear'},{c:'æ¡ƒå­',e:'peach'},{c:'æå­',e:'plum'},
  {c:'èŠ’æœ',e:'mango'},{c:'è‰è“',e:'strawberry'},{c:'æ«»æ¡ƒ',e:'cherry'},{c:'æª¸æª¬',e:'lemon'},
  {c:'èƒ¡è˜¿è””',e:'carrot'},{c:'é¦¬éˆ´è–¯',e:'potato'},{c:'ç•ªèŒ„',e:'tomato'},{c:'å°é»ƒç“œ',e:'cucumber'},
  {c:'éºµåŒ…',e:'bread'},{c:'ç‰›å¥¶',e:'milk'},{c:'é›è›‹',e:'egg'},{c:'èµ·å¸',e:'cheese'},
  {c:'å¥¶æ²¹',e:'butter'},{c:'ç™½é£¯',e:'rice'},{c:'éºµæ¢',e:'noodle'},{c:'è›‹ç³•',e:'cake'},
  {c:'æ¹¯',e:'soup'},{c:'ç³–',e:'sugar'},{c:'é¹½',e:'salt'},{c:'é›è‚‰',e:'chicken'},
  {c:'è±¬è‚‰',e:'pork'},{c:'ç‰›è‚‰',e:'beef'},{c:'é­š',e:'fish'},{c:'è¦',e:'shrimp'},
  {c:'èŸ¹',e:'crab'},{c:'ç« é­š',e:'octopus'},{c:'ç‰ç±³',e:'corn'},{c:'è˜‘è‡',e:'mushroom'},
  {c:'æ´‹è”¥',e:'onion'},{c:'å¤§è’œ',e:'garlic'},{c:'èŒ¶',e:'tea'},{c:'æœæ±',e:'juice'},
  {c:'æ°´',e:'water'},{c:'å­¸æ ¡',e:'school'},{c:'è€å¸«',e:'teacher'},{c:'å­¸ç”Ÿ',e:'student'},
  {c:'ç­ç´š',e:'class'},{c:'æ›¸æ¡Œ',e:'desk'},{c:'æ¤…å­',e:'chair'},{c:'æ›¸',e:'book'},
  {c:'åŸå­ç­†',e:'pen'},{c:'é‰›ç­†',e:'pencil'},{c:'æ©¡çš®æ“¦',e:'eraser'},{c:'å°º',e:'ruler'},
  {c:'æ›¸åŒ…',e:'bag'},{c:'åˆ¶æœ',e:'uniform'},{c:'éŠæ¨‚å ´',e:'playground'},{c:'åœ–æ›¸é¤¨',e:'library'},
  {c:'é›»è…¦',e:'computer'},{c:'é›»è©±',e:'phone'},{c:'æ™‚é˜',e:'clock'},{c:'æ‰‹éŒ¶',e:'watch'},
  {c:'é–€',e:'door'},{c:'çª—æˆ¶',e:'window'},{c:'å±‹é ‚',e:'roof'},{c:'åœ°æ¿',e:'floor'},
  {c:'ç‰†',e:'wall'},{c:'å»šæˆ¿',e:'kitchen'},{c:'è‡¥å®¤',e:'bedroom'},{c:'æµ´å®¤',e:'bathroom'},
  {c:'æ¡Œå­',e:'table'},{c:'ç‡ˆ',e:'lamp'},{c:'åºŠ',e:'bed'},{c:'æ²™ç™¼',e:'sofa'},
  {c:'åœ°æ¯¯',e:'carpet'},{c:'èŠ±åœ’',e:'garden'},{c:'æ¨¹',e:'tree'},{c:'èŠ±',e:'flower'},
  {c:'è‰',e:'grass'},{c:'è‘‰å­',e:'leaf'},{c:'å¤ªé™½',e:'sun'},{c:'æœˆäº®',e:'moon'},
  {c:'æ˜Ÿæ˜Ÿ',e:'star'},{c:'é›²',e:'cloud'},{c:'é›¨',e:'rain'},{c:'é›ª',e:'snow'},
  {c:'é¢¨',e:'wind'},{c:'é¢±é¢¨',e:'storm'},{c:'æ²³',e:'river'},{c:'æ¹–',e:'lake'},
  {c:'æµ·',e:'sea'},{c:'å±±',e:'mountain'},{c:'å°å±±',e:'hill'},{c:'æ£®æ—',e:'forest'},
  {c:'å³¶',e:'island'},{c:'åŸå¸‚',e:'city'},{c:'é„‰æ‘',e:'village'},{c:'åœ‹å®¶',e:'country'},
  {c:'è¡—é“',e:'street'},{c:'é“è·¯',e:'road'},{c:'æ±½è»Š',e:'car'},{c:'å…¬è»Š',e:'bus'},
  {c:'è…³è¸è»Š',e:'bike'},{c:'ç«è»Š',e:'train'},{c:'é£›æ©Ÿ',e:'plane'},{c:'èˆ¹',e:'ship'},
  {c:'å°èˆ¹',e:'boat'},{c:'è²¨è»Š',e:'truck'},{c:'è¨ˆç¨‹è»Š',e:'taxi'},{c:'äº¤é€š',e:'traffic'},
  {c:'å•†åº—',e:'shop'},{c:'å¸‚å ´',e:'market'},{c:'é†«é™¢',e:'hospital'},{c:'é†«ç”Ÿ',e:'doctor'},
  {c:'è­·å£«',e:'nurse'},{c:'è­¦å¯Ÿ',e:'police'},{c:'æ¶ˆé˜²å“¡',e:'fireman'},{c:'è¾²å¤«',e:'farmer'},
  {c:'å»šå¸«',e:'cook'},{c:'æ­Œæ‰‹',e:'singer'},{c:'èˆè€…',e:'dancer'},{c:'ç•«å®¶',e:'artist'},
  {c:'æœ‹å‹',e:'friend'},{c:'å®¶åº­',e:'family'},{c:'åª½åª½',e:'mother'},{c:'çˆ¸çˆ¸',e:'father'},
  {c:'å“¥å“¥',e:'brother'},{c:'å§Šå§Š',e:'sister'},{c:'å¬°å…’',e:'baby'},{c:'å°å­©',e:'child'},
  {c:'ç”·äºº',e:'man'},{c:'å¥³äºº',e:'woman'},{c:'äººå€‘',e:'people'},{c:'å¾®ç¬‘',e:'smile'},
  {c:'ç¬‘',e:'laugh'},{c:'å“­',e:'cry'},{c:'å¿«æ¨‚',e:'happy'},{c:'é›£é',e:'sad'},
  {c:'ç”Ÿæ°£',e:'angry'},{c:'ç–²å€¦',e:'tired'},{c:'é£¢é¤“',e:'hungry'},{c:'å£æ¸´',e:'thirsty'},
  {c:'ä¹¾æ·¨',e:'clean'},{c:'é«’',e:'dirty'},{c:'æ‰“é–‹',e:'open'},{c:'é—œé–‰',e:'close'},
  {c:'ç†±',e:'hot'},{c:'å†·',e:'cold'},{c:'å¤§',e:'big'},{c:'å°',e:'small'},
  {c:'é•·',e:'long'},{c:'çŸ­',e:'short'},{c:'å¿«',e:'fast'},{c:'æ…¢',e:'slow'},
  {c:'æ–°',e:'new'},{c:'èˆŠ',e:'old'},{c:'å¹´è¼•',e:'young'},{c:'å¾®å°',e:'tiny'},
  {c:'å·¨å¤§',e:'huge'},{c:'é‡',e:'heavy'},{c:'è¼•',e:'light'},{c:'å¼·å£¯',e:'strong'},
  {c:'è™›å¼±',e:'weak'},{c:'ç¡¬',e:'hard'},{c:'è»Ÿ',e:'soft'},{c:'ç°¡å–®',e:'easy'},
  {c:'å›°é›£',e:'difficult'},{c:'ä»Šå¤©',e:'today'},{c:'æ˜å¤©',e:'tomorrow'},{c:'æ˜¨å¤©',e:'yesterday'},
  {c:'æ—©ä¸Š',e:'morning'},{c:'ä¸‹åˆ',e:'afternoon'},{c:'æ™šä¸Š',e:'evening'},{c:'å¤œæ™š',e:'night'},
  {c:'æ—©é¤',e:'breakfast'},{c:'åˆé¤',e:'lunch'},{c:'æ™šé¤',e:'dinner'},{c:'ä¸‰æ˜æ²»',e:'sandwich'},
  {c:'æŠ«è–©',e:'pizza'},{c:'é¤…ä¹¾',e:'cookie'},{c:'åšç‰©é¤¨',e:'museum'},{c:'æ£®æ—',e:'forest'},
  {c:'è±¡',e:'elephant'},{c:'å‹•ç‰©',e:'animal'},{c:'åœ–æ›¸é¤¨',e:'library'},{c:'é†«é™¢',e:'hospital'}
];
/* ======= çµæŸé¡Œåº« ======= */

/* emojiMapï¼ˆåŒå‰ï¼‰ */
const emojiMap = {
  apple:'ğŸ',banana:'ğŸŒ',orange:'ğŸŠ',grape:'ğŸ‡',watermelon:'ğŸ‰',pear:'ğŸ',peach:'ğŸ‘',plum:'ğŸ‘',
  mango:'ğŸ¥­',strawberry:'ğŸ“',cherry:'ğŸ’',lemon:'ğŸ‹',carrot:'ğŸ¥•',potato:'ğŸ¥”',tomato:'ğŸ…',cucumber:'ğŸ¥’',
  bread:'ğŸ',milk:'ğŸ¥›',egg:'ğŸ¥š',cheese:'ğŸ§€',butter:'ğŸ§ˆ',rice:'ğŸš',noodle:'ğŸœ',cake:'ğŸ°',
  soup:'ğŸ²',sugar:'ğŸ¬',salt:'ğŸ§‚',chicken:'ğŸ—',pork:'ğŸ–',beef:'ğŸ¥©',fish:'ğŸŸ',shrimp:'ğŸ¦',
  crab:'ğŸ¦€',octopus:'ğŸ™',corn:'ğŸŒ½',mushroom:'ğŸ„',onion:'ğŸ§…',garlic:'ğŸ§„',tea:'ğŸµ',juice:'ğŸ§ƒ',
  water:'ğŸ’§',school:'ğŸ«',teacher:'ğŸ§‘â€ğŸ«',student:'ğŸ§‘â€ğŸ“',class:'ğŸ«',desk:'ğŸª‘',chair:'ğŸª‘',book:'ğŸ“˜',
  pen:'ğŸ–Šï¸',pencil:'âœï¸',eraser:'ğŸ§½',ruler:'ğŸ“',bag:'ğŸ’',uniform:'ğŸ‘”',playground:'ğŸ›',library:'ğŸ›ï¸',
  computer:'ğŸ’»',phone:'ğŸ“±',clock:'ğŸ•’',watch:'âŒš',door:'ğŸšª',window:'ğŸªŸ',roof:'ğŸ ',floor:'ğŸ§±',
  kitchen:'ğŸ½ï¸',bedroom:'ğŸ›ï¸',bathroom:'ğŸ›',table:'ğŸª‘',lamp:'ğŸ’¡',bed:'ğŸ›ï¸',sofa:'ğŸ›‹ï¸',garden:'ğŸŒ³',
  tree:'ğŸŒ²',flower:'ğŸŒ¸',grass:'ğŸŒ¿',leaf:'ğŸƒ',sun:'â˜€ï¸',moon:'ğŸŒ™',star:'â­',cloud:'â˜ï¸',
  rain:'ğŸŒ§ï¸',snow:'â„ï¸',wind:'ğŸ’¨',storm:'ğŸŒ©ï¸',river:'ğŸï¸',lake:'ğŸï¸',sea:'ğŸŒŠ',mountain:'â›°ï¸',
  forest:'ğŸŒ²',island:'ğŸï¸',city:'ğŸ™ï¸',village:'ğŸ¡',country:'ğŸŒ',street:'ğŸ›£ï¸',road:'ğŸ›£ï¸',car:'ğŸš—',
  bus:'ğŸšŒ',bike:'ğŸš²',train:'ğŸš†',plane:'âœˆï¸',ship:'ğŸš¢',boat:'ğŸ›¥ï¸',truck:'ğŸšš',taxi:'ğŸš•',
  shop:'ğŸ¬',market:'ğŸ›’',hospital:'ğŸ¥',doctor:'ğŸ©º',nurse:'ğŸ©º',police:'ğŸ‘®',fireman:'ğŸ‘©â€ğŸš’',farmer:'ğŸ‘¨â€ğŸŒ¾',
  cook:'ğŸ‘©â€ğŸ³',singer:'ğŸ¤',dancer:'ğŸ’ƒ',artist:'ğŸ¨',friend:'ğŸ§‘â€ğŸ¤â€ğŸ§‘',family:'ğŸ‘ª',mother:'ğŸ‘©â€ğŸ‘§',father:'ğŸ‘¨â€ğŸ‘§',
  brother:'ğŸ‘¦',sister:'ğŸ‘§',baby:'ğŸ‘¶',child:'ğŸ§’',man:'ğŸ‘¨',woman:'ğŸ‘©',people:'ğŸ§‘â€ğŸ¤â€ğŸ§‘',smile:'ğŸ˜Š',
  laugh:'ğŸ˜„',cry:'ğŸ˜¢',happy:'ğŸ˜ƒ',sad:'ğŸ˜”',angry:'ğŸ˜ ',tired:'ğŸ˜ª',hungry:'ğŸ˜‹',thirsty:'ğŸ¥¤',
  clean:'ğŸ§¼',dirty:'ğŸ—‘ï¸',open:'ğŸ”“',close:'ğŸ”’',hot:'ğŸ”¥',cold:'ğŸ§Š',big:'ğŸŸ¦',small:'ğŸŸ©',
  long:'ğŸ“',short:'ğŸ”½',fast:'âš¡',slow:'ğŸ¢',new:'ğŸ†•',old:'ğŸ•°ï¸',young:'ğŸ§’',tiny:'ğŸ”¹',
  huge:'ğŸ—»',heavy:'ğŸ‹ï¸',light:'ğŸ’¡',strong:'ğŸ’ª',weak:'ğŸ˜µ',hard:'ğŸª¨',soft:'ğŸ§¸',easy:'âœ…',
  difficult:'âŒ',today:'ğŸ“…',tomorrow:'ğŸ“†',yesterday:'ğŸ“…',morning:'ğŸŒ…',afternoon:'ğŸŒ‡',evening:'ğŸŒ†',night:'ğŸŒƒ',
  breakfast:'ğŸ¥',lunch:'ğŸ±',dinner:'ğŸ½ï¸',sandwich:'ğŸ¥ª',pizza:'ğŸ•',cookie:'ğŸª',museum:'ğŸ›ï¸',elephant:'ğŸ˜',
  animal:'ğŸ¾',library:'ğŸ“š'
};

/* ====== éŠæˆ²ç‹€æ…‹ ====== */
let usedIndices = new Set();
let currentIndex = null;
let slots = []; // DOM slots
let filledCount = 0;
let score = 0;
let answered = 0;

/* DOM references */
const chineseWord = document.getElementById('chineseWord');
const emojiPic = document.getElementById('emojiPic');
const slotsArea = document.getElementById('slotsArea');
const lettersPanel = document.getElementById('letters');
const btnSubmit = document.getElementById('btnSubmit');
const btnNext = document.getElementById('btnNext');
const btnClear = document.getElementById('btnClear');
const feedback = document.getElementById('feedback');
const scoreEl = document.getElementById('score');
const answeredEl = document.getElementById('answered');
const progressBar = document.getElementById('progressBar');
const hiddenInput = document.getElementById('hiddenInput');
const sampleList = document.getElementById('sampleList');

/* åˆå§‹åŒ–é¡¯ç¤ºé¡Œåº«ç¯„ä¾‹ï¼ˆå³å´ï¼‰ */
function populateSample(){
  sampleList.innerHTML = '';
  for(let i=0;i<20 && i<WORDS.length;i++){
    const w=WORDS[i];
    const d=document.createElement('div');
    d.style.padding='6px';
    d.style.background='#fbfeff';
    d.style.borderRadius='8px';
    d.style.border='1px solid #f0f6ff';
    d.innerHTML=`<div style="font-weight:800;color:#0b66b2">${w.c}</div><div style="font-weight:900;color:#2b8aef">${w.e}</div>`;
    sampleList.appendChild(d);
  }
}
populateSample();

/* å»ºç«‹å­—æ¯éµç›¤ */
function createLetters(){
  lettersPanel.innerHTML='';
  const A='A'.charCodeAt(0);
  for(let i=0;i<26;i++){
    const ch=String.fromCharCode(A+i);
    const btn=document.createElement('div');
    btn.className='letterBtn';
    btn.textContent=ch;
    btn.dataset.letter=ch.toLowerCase();
    btn.addEventListener('click',()=>onLetter(ch.toLowerCase()));
    lettersPanel.appendChild(btn);
  }
}
createLetters();

/* å–å¾—éš¨æ©Ÿæœªç”¨é¡Œç›® indexï¼ˆå¦‚æœéƒ½ç”¨å®Œå°±é‡ç½®ï¼‰ */
function pickIndex(){
  if(usedIndices.size >= WORDS.length){ usedIndices.clear(); }
  let idx;
  do{
    idx = Math.floor(Math.random()*WORDS.length);
  }while(usedIndices.has(idx));
  usedIndices.add(idx);
  return idx;
}

/* æ›´ç©©å¥çš„ emoji é¸å–ï¼šç²¾æº–æ¯”å° -> å­å­—ä¸²æ¯”å° -> default */
function findEmojiFor(word){
  if(!word) return 'ğŸ§¸';
  word = word.toLowerCase();
  if(emojiMap[word]) return emojiMap[word];
  // substring match: try keys that are substring of word
  for(const k of Object.keys(emojiMap)){
    if(word.includes(k)) return emojiMap[k];
  }
  // reverse: if key contains word
  for(const k of Object.keys(emojiMap)){
    if(k.includes(word)) return emojiMap[k];
  }
  return 'ğŸ§¸';
}

/* é¡¯ç¤ºä¸‹ä¸€é¡Œï¼ˆæ³¨æ„ï¼šåªæœ‰æŒ‰ä¸‹ä¸€é¡Œæ‰æœƒå‘¼å«ï¼‰ */
function showNext(){
  // reset UI
  feedback.textContent = '';
  feedback.className = 'feedback';
  btnNext.classList.add('disabled'); btnNext.disabled=true;
  btnSubmit.disabled=false; btnSubmit.classList.remove('disabled');
  // pick
  currentIndex = pickIndex();
  const word = WORDS[currentIndex].e;
  chineseWord.textContent = WORDS[currentIndex].c;
  // emoji (æ”¹ç‚ºç©©å¥é¸å–)
  const em = findEmojiFor(word) || 'ğŸ§¸';
  emojiPic.textContent = em;
  // create slots
  slotsArea.innerHTML='';
  slots = [];
  filledCount = 0;
  for(let i=0;i<word.length;i++){
    const s = document.createElement('div');
    s.className='slot';
    s.textContent = '_';
    slotsArea.appendChild(s);
    slots.push(s);
  }
  // re-enable letter buttons visually and functionally
  enableLetterButtons(true);
  // focus the hidden input to capture keyboard
  setTimeout(()=>hiddenInput.focus(),50);
  updateProgress();
}

/* å•Ÿç”¨/åœç”¨å­—æ¯æŒ‰éˆ•ï¼ˆtrue: enable, false: disableï¼‰ */
function enableLetterButtons(enable){
  const btns = lettersPanel.querySelectorAll('.letterBtn');
  btns.forEach(b=>{
    if(enable){
      b.classList.remove('disabled');
      b.style.pointerEvents = 'auto';
    } else {
      b.classList.add('disabled');
      b.style.pointerEvents = 'none';
    }
  });
}

/* è™•ç†æŒ‰å­—æ¯ï¼ˆè‡ªå‹•å¡«å·¦åˆ°å³ï¼‰ */
function onLetter(letter){
  if(currentIndex === null) return;
  const word = WORDS[currentIndex].e;
  if(filledCount >= word.length) return; // å·²æ»¿ï¼Œç¦æ­¢è¼¸å…¥
  // æŠŠå­—æ”¾å…¥ä¸‹ä¸€å€‹ç©ºæ ¼
  slots[filledCount].textContent = letter;
  filledCount++;
  if(filledCount >= word.length){
    // ç•¶æ»¿äº†å¾Œè¦–è¦ºä¸Šåœç”¨å­—æ¯ï¼ˆä¸¦é˜»æ­¢è¼¸å…¥ï¼‰
    
  }
}

/* åˆªé™¤æœ€å¾Œä¸€å€‹å­—æ¯ */
function deleteLast(){
  if(currentIndex === null) return;
  if(filledCount <= 0) return;
  filledCount--;
  slots[filledCount].textContent = '_';
  // å¦‚æœä¹‹å‰è¢«åœç”¨ï¼ŒæŒ‰åˆªé™¤å¾Œé‡æ–°å•Ÿç”¨æŒ‰éˆ•
  enableLetterButtons(true);
}

/* ç›£è½æ¸…é™¤éµ */
btnClear.addEventListener('click', ()=>{
  deleteLast();
  hiddenInput.focus();
});

/* æäº¤æª¢æŸ¥ç­”æ¡ˆ */
function submitAnswer(){
  if(currentIndex === null) return;
  const target = WORDS[currentIndex].e.toLowerCase();
  // collect typed from slots
  let typed = '';
  for(let i=0;i<slots.length;i++){
    const ch = slots[i].textContent;
    typed += (ch === '_' ? '' : ch);
  }
  // if nothing typed, do nothing
  if(typed.length===0){
    feedback.textContent = 'å°šæœªè¼¸å…¥ä»»ä½•å­—æ¯ï¼è«‹è¼¸å…¥å¾Œå†æäº¤';
    feedback.className='feedback incorrect';
    playWrong();
    return;
  }
  // compare
  if(typed.toLowerCase() === target.toLowerCase()){
    feedback.textContent = 'ç­”å°äº†ï¼å¤ªæ£’äº†ï¼';
    feedback.className = 'feedback correct';
    playCorrect();
    score++; scoreElUpdate();
  } else {
    feedback.textContent = `ç­”éŒ¯äº†ï¼æ­£ç¢ºç­”æ¡ˆï¼š ${target}`;
    feedback.className = 'feedback incorrect';
    playWrong();
  }
  answered++;
  answeredEl.textContent = String(answered);
  // after submission, allow Next
  btnNext.classList.remove('disabled'); btnNext.disabled=false;
  // disable submit to prevent double submit
  btnSubmit.disabled=true;
  // lock further typing
  
  updateProgress();
}

/* æ›´æ–°åˆ†æ•¸é¡¯ç¤º */
function scoreElUpdate(){
  document.getElementById('score').textContent = String(score);
}

/* update progress bar: percent of usedIndices/WORDS length */
function updateProgress(){
  const pct = Math.round((usedIndices.size / WORDS.length) * 100);
  progressBar.style.width = pct + '%';
}

/* NEXT æŒ‰éˆ• */
btnNext.addEventListener('click', ()=>{
  if(btnNext.classList.contains('disabled')) return;
  showNext();
});

/* SUBMIT æŒ‰éˆ• */
btnSubmit.addEventListener('click', submitAnswer);

/* éµç›¤æ”¯æ´ï¼šA-Z -> å¡«å­—ï¼›Backspace -> åˆªé™¤ */
hiddenInput.addEventListener('keydown', (e)=>{
  const k = e.key;
  if(/^[a-zA-Z]$/.test(k)){
    onLetter(k.toLowerCase());
    e.preventDefault();
  } else if(k === 'Backspace'){
    deleteLast();
    e.preventDefault();
  } else if(k === 'Enter'){
    // submit
    submitAnswer();
    e.preventDefault();
  }
});

/* ç•¶é é¢é»æ“Šä»»ä½•åœ°æ–¹æ™‚èšç„¦ hiddenInputï¼Œæ–¹ä¾¿éµç›¤è¼¸å…¥ */
document.addEventListener('mousedown',()=>{ setTimeout(()=>hiddenInput.focus(),0); });

/* è‡ªå‹•æŠŠ hiddenInput focusï¼ˆè®“éµç›¤å¯ä»¥ç›´æ¥ç”¨ï¼‰ */
setTimeout(()=>hiddenInput.focus(),200);

/* ===== éŸ³æ•ˆï¼šä½¿ç”¨ WebAudio API å³æ™‚åˆæˆï¼ˆæ”¹æˆä½ è¦çš„å…©ç¨®éŸ³æ•ˆï¼‰ ===== */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = AudioCtx ? new AudioCtx() : null;

/* æ­£ç¢ºï¼šæ¸…äº®ã€Œå®å’šã€ä¸Šå‡éŸ³ï¼ˆçŸ­ï¼‰ */
function playCorrect() {
  if (!audioCtx) return;
  const t = audioCtx.currentTime;

  // ======== ç”¨ FM åˆæˆé‡‘å±¬æ„Ÿ ========
  function fmBell(freq, startTime) {
    let carrier = audioCtx.createOscillator();
    let mod = audioCtx.createOscillator();
    let modGain = audioCtx.createGain();
    let gain = audioCtx.createGain();

    // é‡‘å±¬æ„Ÿ
    mod.frequency.value = freq * 2.5;
    modGain.gain.value = freq * 0.6;
    mod.connect(modGain).connect(carrier.frequency);

    carrier.frequency.value = freq;
    carrier.type = "sine";

    // éŸ³é‡åŒ…çµ¡ï¼ˆçŸ­ä¿ƒèˆ‡äº®ï¼‰
    gain.gain.setValueAtTime(0.7, startTime);
    gain.gain.exponentialRampToValueAtTime(0.0001, startTime + 0.25);

    carrier.connect(gain).connect(audioCtx.destination);
    mod.start(startTime);
    carrier.start(startTime);
    carrier.stop(startTime + 0.26);
    mod.stop(startTime + 0.26);
  }

  // ======== åŠ å…¥ opening click (attack transient) ========
  function addClick(time) {
    let noise = audioCtx.createBufferSource();
    let buffer = audioCtx.createBuffer(1, 44100 * 0.02, 44100);
    let data = buffer.getChannelData(0);
    for (let i = 0; i < data.length; i++) {
      data[i] = (Math.random() * 2 - 1) * (1 - i/data.length); 
    }
    noise.buffer = buffer;

    let g = audioCtx.createGain();
    g.gain.setValueAtTime(0.4, time);
    g.gain.exponentialRampToValueAtTime(0.001, time + 0.02);

    noise.connect(g).connect(audioCtx.destination);
    noise.start(time);
    noise.stop(time + 0.02);
  }

  // ======== åŠ ä¸€é»éå¸¸çŸ­çš„ delayï¼ˆé¡ä¼¼ç©ºæ°£æ„Ÿï¼‰ ========
  let delay = audioCtx.createDelay();
  delay.delayTime.value = 0.015; // 15ms

  let feedback = audioCtx.createGain();
  feedback.gain.value = 0.25;

  delay.connect(feedback).connect(delay);

  // æŠŠ delay æ··åˆé€²ä¸»è¼¸å‡º
  let mix = audioCtx.createGain();
  mix.gain.value = 0.2;
  delay.connect(mix).connect(audioCtx.destination);

  // ======== æ­£å¼å…©è²éŸ³æ•ˆ ========

  // ç¬¬ä¸€è²ï¼ˆå®ï¼‰- é«˜äº®
  addClick(t);
  fmBell(1250, t);

  // ç¬¬äºŒè²ï¼ˆå’šï¼‰- æ›´äº®æ›´é«˜
  addClick(t + 0.11);
  fmBell(1700, t + 0.11);
}

/* éŒ¯èª¤ï¼šä½æ²‰ã€Œé„§é„§ã€å…©çŸ­éŸ³ï¼ˆdeng-dengï¼‰ */
function playWrong() {
  if (!audioCtx) return;
  const t = audioCtx.currentTime;

  // ====== å‰µé€ è¼•å¾®å¤±çœŸï¼ˆåƒå½±ç‰‡çš„é›»å­éŒ¯èª¤éŸ³ï¼‰ ======
  function makeDistortion(amount) {
    let n = 44100,
        curve = new Float32Array(n);
    for (let i = 0; i < n; i++) {
      let x = i * 2 / n - 1;
      curve[i] = (3 + amount) * x * 20 * Math.PI / (Math.PI + amount * Math.abs(x));
    }
    let ws = audioCtx.createWaveShaper();
    ws.curve = curve;
    ws.oversample = "4x";
    return ws;
  }

  let distortion = makeDistortion(10);

  function lowBeep(freq, start) {
    let o = audioCtx.createOscillator();
    let g = audioCtx.createGain();

    o.type = "square";
    o.frequency.setValueAtTime(freq, start);
    o.frequency.exponentialRampToValueAtTime(freq * 0.7, start + 0.12);

    g.gain.setValueAtTime(0.6, start);
    g.gain.exponentialRampToValueAtTime(0.0001, start + 0.16);

    o.connect(distortion).connect(g).connect(audioCtx.destination);
    o.start(start);
    o.stop(start + 0.17);
  }

  // ç¬¬ä¸€è² é„§ï¼ˆè¼ƒé«˜ï¼‰
  lowBeep(200, t);

  // ç¬¬äºŒè² é„§ï¼ˆæ›´ä½ + æ›´æ˜é¡¯ï¼‰
  lowBeep(140, t + 0.18);
}

/* åˆæ¬¡è¼‰å…¥æç¤ºï¼šé¡¯ç¤ºå°‘é‡ç¯„ä¾‹ä¸¦ enable Next */
feedback.textContent = 'æŒ‰ä¸‹ä¸€é¡Œé–‹å§‹ç·´ç¿’ï¼';
feedback.className = 'feedback';
btnNext.classList.remove('disabled'); btnNext.disabled=false;

/* å¿«æ·éµ S ä¸‹ä¸€é¡Œã€R é‡ç½® */
document.addEventListener('keydown',(e)=>{
  if(e.key.toLowerCase() === 's'){ if(!btnNext.classList.contains('disabled')) btnNext.click(); }
  if(e.key.toLowerCase() === 'r'){
    usedIndices.clear(); currentIndex=null; score=0; answered=0;
    scoreElUpdate(); answeredEl.textContent='0'; progressBar.style.width='0%';
    feedback.textContent='å·²é‡ç½®ï¼ŒæŒ‰ä¸‹ä¸€é¡Œé–‹å§‹'; feedback.className='feedback';
    btnNext.classList.remove('disabled'); btnNext.disabled=false;
  }
});
</script>
</body>
</html>
  }
  .card{
    background: #fbfeff;
    border-radius: 14px;
    padding: 16px;
    box-shadow: 0 6px 18px rgba(10,30,80,0.04);
    border: 3px solid rgba(150,200,255,0.25);
    margin-bottom: 14px;
  }

  .chinese {
    font-size: 3rem;
    color: #1b6fb3;
    font-weight:700;
    text-align:center;
    padding: 10px 6px;
  }

  .controls{
    display:flex;
    gap:10px;
    margin-top:8px;
    justify-content: center;
    flex-wrap:wrap;
  }
  button.btn{
    border:none;
    padding:12px 16px;
    border-radius:12px;
    font-weight:700;
    cursor:pointer;
    font-size:1rem;
    box-shadow: 0 6px 12px rgba(10,30,80,0.06);
  }
  .btn-start{ background:#40c057; color:white; }
  .btn-submit{ background: #339af0; color:white; }
  .btn-restart{ background: #ff922b; color:white; }
  .btn-disabled{ opacity:0.5; pointer-events:none; }

  .timer{
    text-align:center;
    margin-top:8px;
  }
  .timer .time{
    font-size:2.6rem;
    font-weight:900;
    color:#ff7b00;
    letter-spacing:2px;
  }
  .timer .label{ color:var(--muted); font-weight:700; }

  .answer-input{
    display:flex;
    gap:8px;
    justify-content:center;
    align-items:center;
    margin-top:12px;
  }
  input[type="text"].answer {
    width:80%;
    max-width:480px;
    padding:14px 12px;
    font-size:1.6rem;
    text-align:center;
    border-radius:12px;
    border:3px solid #a6d1ff;
    background:#f0fbff;
    font-weight:700;
    letter-spacing: 2px;
    color:#0b6fb2;
  }
  input.answer:focus{ outline: none; box-shadow:0 0 0 6px rgba(28,126,214,0.08); }

  .letters {
    margin-top:16px;
    display:grid;
    grid-template-columns: repeat(9, 1fr);
    gap:8px;
    justify-items:stretch;
  }
  @media (max-width:900px){ .letters{ grid-template-columns: repeat(7, 1fr); } }
  @media (max-width:520px){ .letters{ grid-template-columns: repeat(6, 1fr); } }

  .letter {
    user-select:none;
    border-radius:10px;
    padding:10px 6px;
    font-weight:900;
    font-size:1.2rem;
    text-align:center;
    cursor:pointer;
    color:white;
    box-shadow: 0 6px 10px rgba(10,30,80,0.06);
    transition: transform .08s;
  }
  .letter:active{ transform: translateY(2px) scale(.99); }
  .letter.disabled { opacity:0.4; pointer-events:none; transform:none; }

  /* å³å´ï¼šé€²åº¦/åˆ†æ•¸/åˆ—è¡¨ */
  .right{
    width:320px;
    min-width:260px;
  }
  .stat-row{
    display:flex;
    gap:8px;
    justify-content:space-between;
    margin-bottom:10px;
  }
  .stat{
    flex:1;
    background:#fff;
    padding:12px;
    border-radius:10px;
    text-align:center;
    border:3px solid rgba(99,230,190,0.18);
  }
  .stat h4{ margin:0; font-size:1.6rem; color:#2b8aef; }
  .stat p{ margin:4px 0 0; color:var(--muted); font-weight:700; }

  .progress-bar{
    height:18px;
    background:#eef6f2;
    border-radius:12px;
    overflow:hidden;
    margin-top:10px;
    border:3px solid rgba(156,219,203,0.18);
  }
  .progress-fill{
    height:100%;
    width:0%;
    background: linear-gradient(90deg,#20c997,#63e6be);
    transition: width .5s ease;
  }

  .feedback{
    margin-top:12px;
    padding:12px;
    border-radius:10px;
    text-align:center;
    font-weight:900;
    font-size:1.1rem;
    min-height:56px;
  }
  .feedback.ok{ background:#d3f9d8; color: #2b8a3e; border:3px solid #69db7c; }
  .feedback.bad{ background:#ffe3e3; color:#c92a2a; border:3px solid #ff8787; }
  .word-list{
    margin-top:14px;
    padding-top:8px;
    border-top:2px dashed #e6eefc;
  }
  .word-list h3{ text-align:center; color:#416; }
  .word-pair{
    display:flex;
    justify-content:space-between;
    gap:10px;
    padding:6px 8px;
    border-radius:8px;
    background:#fbfdff;
    margin-bottom:6px;
    border:1px solid #f0f6ff;
  }

  /* å°æç¤º */
  .hint{
    margin-top:8px;
    text-align:center;
    color:#555;
    font-weight:700;
  }

  footer{
    margin-top:16px;
    text-align:center;
    color:var(--muted);
    font-size:.95rem;
  }
</style>
</head>
<body>
  <div class="wrap" role="application" aria-label="å–®å­—é»˜å¯«éŠæˆ²">
    <header>
      <h1>è¶£å‘³å–®å­—é»˜å¯«ï¼ˆå°å­¸ç‰ˆï¼‰</h1>
      <p class="lead">é¡¯ç¤ºä¸­æ–‡ï¼Œè«‹è¼¸å…¥å®Œæ•´è‹±æ–‡å–®å­—ã€‚å¯é»å­—æ¯æ–¹å¡Šæˆ–ç›´æ¥éµç›¤è¼¸å…¥ã€‚ç¥ä½ ç©å¾—é–‹å¿ƒï¼</p>
    </header>

    <main class="game" id="app">
      <section class="left">
        <div class="card" aria-live="polite">
          <div class="chinese" id="chineseWord">æŒ‰ã€Œé–‹å§‹ã€é¡¯ç¤ºä¸­æ–‡</div>

          <div class="controls" id="topControls">
            <button class="btn btn-start" id="startBtn" aria-pressed="false">é–‹å§‹</button>
            <button class="btn btn-submit btn-disabled" id="submitBtn">æäº¤</button>
            <button class="btn btn-restart" id="restartBtn">é‡æ–°é–‹å§‹</button>
          </div>

          <div class="timer" role="timer" aria-atomic="true">
            <div class="time" id="timeDisplay">00</div>
            <div class="label">å€’æ•¸ç§’æ•¸</div>
          </div>

          <div class="answer-input">
            <input type="text" class="answer" id="answerInput" autocomplete="off" inputmode="latin" aria-label="è¼¸å…¥å–®å­—" placeholder="è¼¸å…¥æˆ–é»é¸å­—æ¯..." />
          </div>

          <div class="hint" id="hintText">æç¤ºï¼šå¯ç”¨æ»‘é¼ é»å­—æ¯æˆ–ç›´æ¥éµç›¤è¼¸å…¥ã€‚æŒ‰ Enter å¯æäº¤ã€‚</div>

          <!-- å­—æ¯æŒ‰éˆ• -->
          <div class="letters card" id="lettersPanel" aria-label="å­—æ¯é¢æ¿">
            <!-- JS æœƒå‹•æ…‹ç”Ÿæˆ A-Z æŒ‰éˆ• -->
          </div>

          <div style="margin-top:12px; text-align:center; color:#666; font-weight:700;">
            å·²è¼¸å…¥ï¼š<span id="typedDisplay">ï¼ˆç„¡ï¼‰</span>
          </div>
        </div>

        <!-- é¡¯ç¤ºç­”æ¡ˆèˆ‡æç¤º -->
        <div class="card" id="bottomCard" aria-live="polite">
          <div class="feedback" id="feedbackArea">æº–å‚™å¥½äº†å—ï¼ŸæŒ‰é–‹å§‹ï¼</div>
        </div>
      </section>

      <aside class="right">
        <div class="card">
          <div class="stat-row">
            <div class="stat">
              <h4 id="scoreVal">0</h4>
              <p>å¾—åˆ†</p>
            </div>
            <div class="stat">
              <h4 id="attemptVal">0</h4>
              <p>ç­”é¡Œæ•¸</p>
            </div>
          </div>

          <div class="progress-label" style="font-weight:900; color:#0b6fb2; margin-top:4px;">
            é€²åº¦
          </div>
          <div class="progress-bar" aria-hidden="false">
            <div class="progress-fill" id="progressFill"></div>
          </div>

          <div style="margin-top:10px;">
            <button class="btn btn-start" id="showAnswerBtn" style="width:100%;">é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆï¼ˆæç¤ºï¼‰</button>
          </div>
        </div>

        <div class="card word-list">
          <h3>å–®å­—åˆ—è¡¨ï¼ˆä¸­ â€” è‹±ï¼‰</h3>
          <div id="wordList">
            <!-- JS å¡«å……åå–® -->
          </div>
        </div>
      </aside>
    </main>

    <footer>
      <small>è¨­è¨ˆçµ¦å°å­¸ç”Ÿï¼šå¤§æŒ‰éˆ•ã€ç°¡å–®æ–‡å­—ã€è‰²å½©å‹å–„ã€‚ç¥å­¸ç¿’æ„‰å¿«ï¼</small>
    </footer>
  </div>

<script>
/*
  å®Œæ•´å–®æ–‡ä»¶ JSï¼š
  - æ”¯æ´é»å­—æ¯æˆ–éµç›¤è¼¸å…¥
  - å€’è¨ˆæ™‚ï¼ˆæ¯é¡Œå¯è¨­å®šç§’æ•¸ï¼‰
  - éš¨æ©Ÿé¡Œç›®ï¼ˆå¯èª¿æ•´é¡Œç›®æ¬¡æ•¸ï¼‰
  - æª¢æŸ¥ç­”æ¡ˆï¼ˆå¤§å°å¯«ä¸æ•æ„Ÿï¼‰
  - é¡¯ç¤ºé€²åº¦ã€å¾—åˆ†ã€ç­”é¡Œæ•¸
*/

(function(){
  // --- å¯èª¿åƒæ•¸ ---
  const QUESTION_COUNT = 20;       // ä¸€å›åˆçš„é¡Œç›®æ•¸ï¼ˆé€²åº¦æ¢æ»¿ï¼‰
  const DEFAULT_SECONDS = 18;      // æ¯é¡Œå€’æ•¸ç§’æ•¸
  const WORDS = [
    // å¸¸ç”¨å°å­¸è©å½™ï¼šä¸­æ–‡ â€” è‹±æ–‡
    {c:'è˜‹æœ', e:'apple'},
    {c:'æ©˜å­', e:'orange'},
    {c:'é¦™è•‰', e:'banana'},
    {c:'è‘¡è„', e:'grape'},
    {c:'è¥¿ç“œ', e:'watermelon'},
    {c:'ç‹—', e:'dog'},
    {c:'è²“', e:'cat'},
    {c:'é­š', e:'fish'},
    {c:'é³¥', e:'bird'},
    {c:'è€å¸«', e:'teacher'},
    {c:'å­¸ç”Ÿ', e:'student'},
    {c:'æ›¸', e:'book'},
    {c:'é‰›ç­†', e:'pencil'},
    {c:'æ©¡çš®', e:'eraser'},
    {c:'å­¸æ ¡', e:'school'},
    {c:'å®¶', e:'home'},
    {c:'é–€', e:'door'},
    {c:'çª—æˆ¶', e:'window'},
    {c:'æ¡Œå­', e:'table'},
    {c:'æ¤…å­', e:'chair'},
    {c:'çƒ', e:'ball'},
    {c:'é›¨', e:'rain'},
    {c:'å¤ªé™½', e:'sun'},
    {c:'æœˆäº®', e:'moon'},
    {c:'æ˜Ÿæ˜Ÿ', e:'star'},
    {c:'è»Š', e:'car'},
    {c:'èˆ¹', e:'boat'},
    {c:'é£›æ©Ÿ', e:'plane'},
    {c:'è˜‘è‡', e:'mushroom'},
    {c:'ç´…è‰²', e:'red'},
    {c:'è—è‰²', e:'blue'},
    {c:'é»ƒè‰²', e:'yellow'},
    {c:'ç¶ è‰²', e:'green'},
    {c:'é»‘è‰²', e:'black'},
    {c:'ç™½è‰²', e:'white'},
    {c:'åª½åª½', e:'mother'},
    {c:'çˆ¸çˆ¸', e:'father'},
    {c:'å§å§', e:'sister'},
    {c:'å“¥å“¥', e:'brother'},
    {c:'æ™‚é–“', e:'time'},
    {c:'æ°´', e:'water'},
    {c:'ç‰›å¥¶', e:'milk'},
    {c:'è›‹', e:'egg'},
    {c:'éºµåŒ…', e:'bread'},
    {c:'ç³–', e:'sugar'},
    {c:'è˜‹æœæ´¾', e:'pie'},
    {c:'é†«ç”Ÿ', e:'doctor'},
    {c:'åœ–æ›¸é¤¨', e:'library'},
    {c:'å‹•ç‰©', e:'animal'},
    {c:'åŸå¸‚', e:'city'},
    {c:'é„‰æ‘', e:'village'},
    {c:'ç­ç´š', e:'class'},
    {c:'æœ‹å‹', e:'friend'}
  ];

  // --- DOM åƒè€ƒ ---
  const startBtn = document.getElementById('startBtn');
  const submitBtn = document.getElementById('submitBtn');
  const restartBtn = document.getElementById('restartBtn');
  const timeDisplay = document.getElementById('timeDisplay');
  const chineseWord = document.getElementById('chineseWord');
  const answerInput = document.getElementById('answerInput');
  const lettersPanel = document.getElementById('lettersPanel');
  const feedbackArea = document.getElementById('feedbackArea');
  const scoreVal = document.getElementById('scoreVal');
  const attemptVal = document.getElementById('attemptVal');
  const progressFill = document.getElementById('progressFill');
  const typedDisplay = document.getElementById('typedDisplay');
  const showAnswerBtn = document.getElementById('showAnswerBtn');
  const wordListContainer = document.getElementById('wordList');

  // --- å…§éƒ¨ç‹€æ…‹ ---
  let currentWord = null;
  let remainingSeconds = DEFAULT_SECONDS;
  let timerId = null;
  let isRunning = false;
  let score = 0;
  let attempts = 0;
  let askedCount = 0;
  let order = []; // éš¨æ©Ÿé¡Œåºï¼ˆindexï¼‰
  let allowSubmit = false;

  // --- åˆå§‹åŒ– UI / ç”¢ç”Ÿå­—æ¯æŒ‰éˆ• / åˆ—è¡¨ ---
  const palette = [
    '#ff6b6b','#ffd43b','#51cf66','#339af0','#845ef7','#ff922b','#16a34a','#ef476f','#06b6d4',
    '#f783ac','#7c3aed','#06d6a0','#f59e0b','#ff85a1'
  ];
  function randColor(i){
    return palette[i % palette.length];
  }

  function createLetterButtons(){
    lettersPanel.innerHTML = '';
    const Acode = 'A'.charCodeAt(0);
    for(let i=0;i<26;i++){
      const ch = String.fromCharCode(Acode + i);
      const div = document.createElement('div');
      div.className = 'letter';
      div.textContent = ch;
      div.setAttribute('data-letter', ch);
      const color = randColor(i);
      div.style.background = color;
      div.style.border = '3px solid rgba(255,255,255,0.08)';
      div.style.boxShadow = 'inset 0 -6px 12px rgba(0,0,0,0.06), 0 6px 12px rgba(10,30,80,0.06)';
      div.addEventListener('click', onLetterClick);
      lettersPanel.appendChild(div);
    }
  }

  function populateWordList(){
    wordListContainer.innerHTML = '';
    WORDS.forEach(w=>{
      const row = document.createElement('div');
      row.className = 'word-pair';
      row.innerHTML = '<div style="font-weight:800;color:#1b6fb3">'+ w.c +'</div><div style="font-weight:900;color:#2b8aef">'+ w.e +'</div>';
      wordListContainer.appendChild(row);
    });
  }

  // --- é¸é¡Œï¼ˆéš¨æ©Ÿç„¡é‡è¤‡ï¼‰---
  function prepareOrder(){
    const indices = WORDS.map((_,i)=>i);
    // Fisher-Yates shuffle
    for(let i=indices.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [indices[i], indices[j]] = [indices[j], indices[i]];
    }
    // å–å‰ QUESTION_COUNTï¼ˆæˆ–å…¨éƒ¨ï¼‰
    order = indices.slice(0, Math.min(QUESTION_COUNT, indices.length));
    askedCount = 0;
  }

  // --- é¡¯ç¤ºï¼ˆæ–°é¡Œï¼‰ ---
  function nextQuestion(){
    if(askedCount >= order.length){
      // å›åˆçµæŸ
      endRound();
      return;
    }
    const idx = order[askedCount];
    currentWord = WORDS[idx];
    chineseWord.textContent = currentWord.c;
    answerInput.value = '';
    typedDisplay.textContent = 'ï¼ˆç„¡ï¼‰';
    feedbackArea.textContent = 'è«‹è¼¸å…¥å®Œæ•´çš„è‹±æ–‡å–®å­—ï¼ŒæŒ‰æäº¤æˆ– Enterã€‚';
    feedbackArea.className = 'feedback';
    remainingSeconds = DEFAULT_SECONDS;
    updateTimerDisplay();
    enableSubmit(false);
    clearLetterSelection();
    answerInput.focus();
    askedCount++;
    updateProgress();
  }

  function updateProgress(){
    const pct = Math.round(( (askedCount-1) / order.length ) * 100);
    progressFill.style.width = pct + '%';
  }

  function endRound(){
    isRunning = false;
    clearInterval(timerId);
    timerId = null;
    feedbackArea.textContent = `æœ¬å›åˆçµæŸï¼å…±ç­”é¡Œ ${attempts} é¡Œï¼Œå¾—åˆ† ${score}ã€‚`;
    feedbackArea.className = 'feedback';
    chineseWord.textContent = 'å›åˆå·²çµæŸï¼ŒæŒ‰ã€Œé‡æ–°é–‹å§‹ã€æˆ–ã€Œé–‹å§‹ã€å†è©¦ä¸€æ¬¡';
    enableSubmit(false);
    startBtn.classList.remove('btn-disabled');
    answerInput.blur();
    progressFill.style.width = '100%';
  }

  function startRound(){
    score = 0;
    attempts = 0;
    scoreVal.textContent = '0';
    attemptVal.textContent = '0';
    prepareOrder();
    createLetterButtons();
    clearInterval(timerId);
    timerId = null;
    isRunning = true;
    startBtn.classList.add('btn-disabled');
    enableSubmit(false);
    nextQuestion();
    startTimer();
  }

  function restartRound(){
    // ä¿ç•™é¡Œåº«ä½†é‡æ–°é–‹å§‹æ–°å›åˆ
    startBtn.classList.remove('btn-disabled');
    prepareOrder();
    score = 0;
    attempts = 0;
    askedCount = 0;
    scoreVal.textContent = '0';
    attemptVal.textContent = '0';
    progressFill.style.width = '0%';
    feedbackArea.textContent = 'å·²é‡ç½®ï¼ŒæŒ‰é–‹å§‹ã€‚';
    feedbackArea.className = 'feedback';
    chineseWord.textContent = 'æŒ‰ã€Œé–‹å§‹ã€é¡¯ç¤ºé¡Œç›®';
    clearInterval(timerId);
    timerId = null;
    isRunning = false;
    enableSubmit(false);
    clearLetterSelection();
  }

  // --- è¨ˆæ™‚å™¨ ---
  function startTimer(){
    if(timerId) clearInterval(timerId);
    timerId = setInterval(()=>{
      remainingSeconds--;
      updateTimerDisplay();
      if(remainingSeconds <= 0){
        // æ™‚é–“åˆ°ï¼Œè¦–ç‚ºéŒ¯èª¤ä¸¦é€²å…¥ä¸‹ä¸€é¡Œ
        handleSubmit(true); // true è¡¨ç¤ºå› æ™‚é–“åˆ°è‡ªå‹•æäº¤ï¼ˆéŒ¯èª¤ï¼‰
      }
    }, 1000);
  }

  function updateTimerDisplay(){
    timeDisplay.textContent = String(remainingSeconds).padStart(2,'0');
  }

  // --- å­—æ¯é»æ“Šè™•ç† ---
  function onLetterClick(e){
    const letter = e.currentTarget.getAttribute('data-letter') || '';
    if(!letter) return;
    // æŠŠå­—æ¯é™„åŠ åˆ°è¼¸å…¥æ¡†
    answerInput.value = (answerInput.value + letter).slice(0, 30); // é™é•·
    typedDisplay.textContent = answerInput.value || 'ï¼ˆç„¡ï¼‰';
    // æŠŠè©²æŒ‰éˆ•æ”¹æˆ disabledï¼ˆé˜²æ­¢é‡è¤‡é»ï¼‰
    e.currentTarget.classList.add('disabled');
    enableSubmit(true);
    answerInput.focus();
  }

  function clearLetterSelection(){
    const els = lettersPanel.querySelectorAll('.letter');
    els.forEach(el=>el.classList.remove('disabled'));
  }

  // --- æäº¤/æª¢æŸ¥ç­”æ¡ˆ ---
  function enableSubmit(flag){
    allowSubmit = !!flag;
    if(allowSubmit){
      submitBtn.classList.remove('btn-disabled');
    } else {
      submitBtn.classList.add('btn-disabled');
    }
  }

  function handleSubmit(isTimeout=false){
    if(!isRunning) return;
    const typed = (answerInput.value || '').trim();
    const correct = currentWord ? currentWord.e.trim().toLowerCase() : '';
    attempts++;
    attemptVal.textContent = String(attempts);
    // åœè¨ˆæ™‚ä¸€å°æ®µæ™‚é–“é¡¯ç¤ºçµæœ
    clearInterval(timerId);
    timerId = null;
    if(!typed || isTimeout){
      // éŒ¯èª¤
      feedbackArea.textContent = `æ™‚é–“åˆ°æˆ–æœªè¼¸å…¥ï¼æ­£ç¢ºç­”æ¡ˆï¼š ${correct}`;
      feedbackArea.className = 'feedback bad';
    } else {
      if(typed.toLowerCase() === correct.toLowerCase()){
        score++;
        scoreVal.textContent = String(score);
        feedbackArea.textContent = 'ç­”å°äº†ï¼å¾ˆå¥½ ğŸ‘';
        feedbackArea.className = 'feedback ok';
      } else {
        feedbackArea.textContent = `ç­”éŒ¯äº†ï¼ä½ çš„ç­”æ¡ˆ: ${typed}ï¼›æ­£ç¢º: ${correct}`;
        feedbackArea.className = 'feedback bad';
      }
    }

    // é¡¯ç¤ºæ­£ç¢ºç­”æ¡ˆ 1.5 ç§’å¾Œé€²ä¸‹ä¸€é¡Œ
    setTimeout(()=>{
      // è‹¥é¡Œç›®åšå®Œå‰‡çµæŸ
      if(askedCount >= order.length){
        endRound();
        return;
      }
      // å¦å‰‡ä¸‹ä¸€é¡Œ
      nextQuestion();
      startTimer();
    }, 1200);
  }

  // --- é¡¯ç¤ºç­”æ¡ˆæç¤º ---
  function revealAnswer(){
    if(!currentWord) return;
    feedbackArea.textContent = `æç¤ºç­”æ¡ˆï¼š ${currentWord.e}`;
    feedbackArea.className = 'feedback';
  }

  // --- éµç›¤è™•ç†ï¼ˆè¼¸å…¥/Backspace/Enterï¼‰ ---
  answerInput.addEventListener('input', (e)=>{
    // è‹¥æœ‰è¼¸å…¥å‰‡å•Ÿç”¨æäº¤
    const v = e.target.value || '';
    typedDisplay.textContent = v ? v : 'ï¼ˆç„¡ï¼‰';
    // ç•¶ä½¿ç”¨éµç›¤è¼¸å…¥æ™‚ï¼Œè§£é™¤ letter æŒ‰éˆ• disabledï¼ˆé¿å…è·Ÿé»æ“Šæ··æ·†ï¼‰
    const els = lettersPanel.querySelectorAll('.letter');
    els.forEach(el=>el.classList.remove('disabled'));
    enableSubmit(!!v.trim());
  });

  answerInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      e.preventDefault();
      if(!submitBtn.classList.contains('btn-disabled')){
        handleSubmit(false);
      }
    }
    if(e.key === 'Escape'){
      answerInput.value = '';
      typedDisplay.textContent = 'ï¼ˆç„¡ï¼‰';
      enableSubmit(false);
    }
  });

  // å…¨åŸŸéµç›¤ï¼šè‹¥ä½¿ç”¨è€…ç›´æ¥æŒ‰ A~Zï¼Œä¹Ÿè¼¸å…¥åˆ°æ¬„ä½ï¼ˆä¸æœƒè§¸ç™¼å­—æ¯ disabledï¼‰
  document.addEventListener('keydown', (e)=>{
    if(!isRunning) return;
    const k = e.key;
    if(/^[a-zA-Z]$/.test(k)){
      answerInput.value = answerInput.value + k.toLowerCase();
      typedDisplay.textContent = answerInput.value;
      enableSubmit(!!answerInput.value.trim());
    }
    if(k === 'Backspace'){
      // ä¿æŒæ­£å¸¸ç€è¦½å™¨åˆªé™¤è¡Œç‚º
      // typedDisplay åœ¨ input event è£¡æœƒæ›´æ–°
    }
  });

  // --- äº‹ä»¶ç¶å®š ---
  startBtn.addEventListener('click', ()=>{
    if(startBtn.classList.contains('btn-disabled')) return;
    startRound();
  });
  restartBtn.addEventListener('click', ()=>{
    restartRound();
  });
  submitBtn.addEventListener('click', ()=>{
    if(submitBtn.classList.contains('btn-disabled')) return;
    handleSubmit(false);
  });
  showAnswerBtn.addEventListener('click', revealAnswer);

  // --- åˆå§‹åŒ– ---
  createLetterButtons();
  populateWordList();
  prepareOrder();
  updateTimerDisplay();
  enableSubmit(false);

  // é¡å¤–ï¼šåœ¨å°è¢å¹•ä¸Šè‡ªå‹•ç¸®çŸ­å­—æ¯æ’åˆ—ï¼ˆå·²ä½¿ç”¨ media queryï¼‰
})();
</script>
</body>
</html>


